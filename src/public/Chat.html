<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Chat </title>
    <link rel="stylesheet" href="./style.css">
    <link rel="shortcut" href="./Imagens/icon.png" type="img/png">
</head>
<body>
    <div class="menu">
        <img src="./Imagens/icon.png" alt="icone">
        <button type="button" class="sair" id="sairChat">Sair do chat</button>
    </div>
    <div class="principal">
        <div class="principal-barra">
            <input type="text" id="EnvMsg" placeholder="Escreva uma mensagem...">
            <button onclick="electron.MinmizarJanela()"> - </button>
            <button onclick="electron.MaximizarJanela()"> o </button>
            <button onclick="electron.FecharJanela()"> x </button>
        </div>
        <div id="principal-conversa" class="principal-conversa">
            <div class="conversa">
                <span> Voluptatibus  </span>
                Laudantium, expedita sit ipsam consequuntur dignissimos.
            </div>
        </div>
    </div>
    <script>
        const EMsg = document.querySelector('input[id="EnvMsg"]')
        const campoConversa = document.querySelector("#principal-conversa")
        const sair = document.querySelector('button[id="sairChat"]')

        sair.addEventListener("click", (event) => {electron.MudarPagina("Principal")})
        EMsg.addEventListener("keypress", (event) => {
            if(event.key == "Enter"){
                event.preventDefault()
                electron.EnviarMsg(EMsg.value)
                EMsg.value = null
            }
        })
        setInterval(async () => {
            var result = await electron.ExibirChat();
            //console.log(result.messages)
            function getName(item){return[item.user_id].join('');}
            function getMsg(item){return[item.content].join('');}
            function organizado(){
                document.querySelector("#principal-conversa").innerHTML = result.messages.map((msg) => {
                    return `<div class="conversa"><span>${getName(msg)}</span>${getMsg(msg)}</div>`;}).join('')
            }
            organizado()
            /*for (i = 0; i < result.length; ++i) {
                let div = campoConversa.createElement('div');
                div.innerText = result[i];
                campoConversa.appendChild(div);
                //console.log(data[i]);
            }*/
                /*.then((resultados) => {
                    querySelector(".conversa").innerHTML = "asdasd"
                    /*campoConversa.innerHTML = null
                    for (let resultado of resultados) {
                        const conversa = document.createElement("div")
                        conversa.setAttribute("class", "conversa")
                        const nome = document.createElement("span")
                        nome.innerHTML = resultado.nome
                        conversa.appendChild(nome)
                        conversa.append(" ")
                        conversa.append(resultado.mensagem)
                        campoConversa.appendChild(conversa)
                    }
                })*/
        }, 2000)
    
        
    </script>
</body>
</html>